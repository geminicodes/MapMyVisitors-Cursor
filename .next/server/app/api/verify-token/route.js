"use strict";(()=>{var e={};e.id=28,e.ids=[28],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},26169:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{GET:()=>d});var o=t(49303),n=t(88716),i=t(60670),u=t(87070),a=t(45930),p=t(85662);async function d(e){try{let r=e.nextUrl.searchParams.get("token");if(!r)return u.NextResponse.json({success:!1,error:"No token provided"},{status:400});let t=(0,a.D)(r);if(!t)return u.NextResponse.json({success:!1,error:"Invalid or expired token"},{status:401});let s=(0,p.m)(),{data:o,error:n}=await s.from("users").select("id, email, widget_id, paid").eq("id",t.userId).maybeSingle();if(n)return console.error("[Verify Token] Database error:",n),u.NextResponse.json({success:!1,error:"Database error"},{status:500});if(!o)return u.NextResponse.json({success:!1,error:"User not found"},{status:404});if(!o.paid)return u.NextResponse.json({success:!1,error:"Payment required"},{status:402});return console.log("[Verify Token] Token verified successfully",{userId:o.id,widgetId:o.widget_id}),u.NextResponse.json({success:!0,widgetId:o.widget_id,email:o.email})}catch(e){return console.error("[Verify Token] Error:",e),u.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/verify-token/route",pathname:"/api/verify-token",filename:"route",bundlePath:"app/api/verify-token/route"},resolvedPagePath:"/workspaces/MapMyVisitors-Cursor/app/api/verify-token/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:x}=c,v="/api/verify-token/route";function m(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},85662:(e,r,t)=>{t.d(r,{m:()=>o});var s=t(94738);function o(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,r=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!r)throw Error("Missing Supabase environment variables");return(0,s.eI)(e,r,{auth:{persistSession:!1,autoRefreshToken:!1}})}},45930:(e,r,t)=>{t.d(r,{D:()=>u,Q:()=>i});var s=t(41482),o=t.n(s);let n=process.env.JWT_SECRET||"";function i(e,r){let t={userId:e,widgetId:r,exp:Math.floor(Date.now()/1e3)+86400};return o().sign(t,n)}function u(e){try{let r=o().verify(e,n);return{userId:r.userId,widgetId:r.widgetId}}catch(e){return console.error("[Token] Verification failed:",e.message),null}}n&&n.length}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,37,70,482],()=>t(26169));module.exports=s})();