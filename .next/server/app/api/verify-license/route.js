"use strict";(()=>{var e={};e.id=732,e.ids=[732],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},4511:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>x,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var t={};r.r(t),r.d(t,{POST:()=>d});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),p=r(60167),c=r(85662);let u=process.env.GUMROAD_API_TOKEN,l=process.env.GUMROAD_PRODUCT_ID;async function d(e){try{let s;let{email:r,licenseKey:t}=await e.json();if(!r||!t)return o.NextResponse.json({message:"Email and license key are required"},{status:400});if(!u||!l)return o.NextResponse.json({message:"Server configuration error. Please contact support."},{status:500});let a=new URLSearchParams;a.append("product_id",l),a.append("license_key",t),a.append("increment_uses_count","false");let i=await fetch("https://api.gumroad.com/v2/licenses/verify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString()}),n=await i.json();if(!n.success)return o.NextResponse.json({message:"Invalid license key"},{status:401});if(n.purchase?.email!==r)return o.NextResponse.json({message:"Email does not match license"},{status:401});let d=(0,c.m)(),{data:m,error:x}=await d.from("customers").select("*").eq("license_key",t).maybeSingle();if(x)return console.error("Database error:",x),o.NextResponse.json({message:"Database error. Please try again."},{status:500});if(m){if(m.email!==r)return o.NextResponse.json({message:"This license key is already registered to another email"},{status:401});s=m}else{let{data:e,error:a}=await d.from("customers").insert({email:r,license_key:t,plan:"basic",purchased_at:n.purchase?.sale_timestamp||new Date().toISOString(),pageviews_used:0,pageviews_limit:1e4,website_domains:[],status:"active"}).select().single();if(a)return console.error("Database insert error:",a),o.NextResponse.json({message:"Failed to create customer record. Please try again."},{status:500});s=e}let f=(0,p.V3)({id:s.id,email:s.email,licenseKey:s.license_key,plan:s.plan});return await (0,p.MY)(f),o.NextResponse.json({success:!0,message:"License verified successfully",customer:{id:s.id,email:s.email,plan:s.plan}})}catch(e){return console.error("License verification error:",e),o.NextResponse.json({message:"Verification failed. Please try again."},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/verify-license/route",pathname:"/api/verify-license",filename:"route",bundlePath:"app/api/verify-license/route"},resolvedPagePath:"/workspaces/MapMyVisitors-Cursor/app/api/verify-license/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:x,staticGenerationAsyncStorage:f,serverHooks:g}=m,y="/api/verify-license/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},85662:(e,s,r)=>{r.d(s,{m:()=>a});var t=r(94738);function a(){let e=process.env.NEXT_PUBLIC_SUPABASE_URL,s=process.env.SUPABASE_SERVICE_ROLE_KEY||process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!s)throw Error("Missing Supabase environment variables");return(0,t.eI)(e,s,{auth:{persistSession:!1,autoRefreshToken:!1}})}}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[948,37,70,482,167],()=>r(4511));module.exports=t})();